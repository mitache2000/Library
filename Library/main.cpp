#include <iostream>
#include "fstream"
#include "Vector.h"
#include "String.h"
#include "User.h"
#include "Commands.h"

void PrintCommandsForLibrary() {
	std::cout << "Available commands" << std::endl;
	std::cout << "You have to be logged in to make this operations:" << std::endl;
	std::cout << "You can add or remove users only if you are admin (users add/remove)." << std::endl;
	std::cout << "You can add or remove books only if you are admin (books add/remove)." << std::endl;
	std::cout << "You can view all books, find one book and sort books by criteria (books all/info/find/sort)." << std::endl;

	std::cout << "If you have an account you can sign in by typing \"login\" and writing the correct information." << std::endl;
	std::cout << "Please contact admin in order to create new account." << std::endl; 
}

int Start(String& path) {
	std::ifstream in;
	in.open(path.string, std::ios::in);
	if (!in.is_open())
	{
		return 1;
	}

	Commands currentSession(path);

	std::cout << "If you want to close the program type: \"close\"" << std::endl;
	PrintCommandsForLibrary();


	String command;
	do
	{
		std::cout << "Enter command: ";
		std::cin >> command;
		if (command == "")
			continue;
		if (command == "login")
			currentSession.LogInUser();
		else if (command == "logout")
			currentSession.LogoutUser();
		else if (command == "users")
			currentSession.AdminActions(path);
		else if (command == "books")
			currentSession.BookSplit();
		else if (command == "save")
			currentSession.SaveBooks(path);
		else if (command == "exit")
			std::cout << "You have to close the file in order to exit the program" << std::endl;
		else if (command == "saveas")
		{
			String newPath;
			std::cin >> newPath;
			currentSession.SaveBooks(newPath);
			std::cout << "Succesfully saved at: " << newPath << std::endl;
		}
		else if (command == "close")
			continue;
		else
			std::cout << "Invalid command! \n";
	} while (!(command == "close"));

	std::cout << "Succesfully closed the file" << std::endl;
}

int main() {

	String command;
	do
	{
		std::cout << "Please enter command: ";
		std::cin >> command;
		if (command == "open")
		{
			String path;
			std::cin >> path;

			int result = Start(path);
			if (result == 1)
			{
				std::cout << "The file with name " << path << " doesn't exist" << std::endl;
				continue;
			}
		}
		else if (command == "help")
		{
			std::cout << "Available commands" << std::endl;
			std::cout << "open <path>(supported only for books) - opens <file>" << std::endl;
			std::cout << "save - saves the information which has been generated by the current session in the openeed file" << std::endl;
			std::cout << "saveas <path> - saves the information which has been generated by the current session in other file" << std::endl;
			std::cout << "close - closes the currently open file" << std::endl;
			std::cout << "exit - closes the program" << std::endl;
			std::cout << "help - prints information for the commands" << std::endl;
		}
		else if (command == "save" || command == "saveas")
		{
			std::cout << "Please log in in to do these operations!" << std::endl;
			continue;
		}
		else
		{
			std::cout << "Invalid command! Type \"help\" to see all the commands!" << std::endl;
			continue;
		}
	} while (!(command == "exit"));

	Book b1();
}